# Deployment Guide - Railway/Render

## ğŸš€ Quick Deployment Steps

### Option A: Railway (Recommended)

1. **Create Account**
   - Go to [railway.app](https://railway.app)
   - Sign up with GitHub

2. **Create New Project**
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Choose your Gambo repository

3. **Add PostgreSQL Database**
   - Click "New" â†’ "Database" â†’ "PostgreSQL"
   - Railway will automatically add `DATABASE_URL` to environment

4. **Configure Environment Variables**

   Click on your service â†’ "Variables" â†’ Add these:

   ```bash
   # NextAuth
   NEXTAUTH_URL=https://your-app.up.railway.app
   NEXTAUTH_SECRET=<run: openssl rand -base64 32>

   # AI Service
   GROQ_API_KEY=your_groq_api_key_here

   # BetsAPI Tokens
   BETSAPI_SOCCER_TOKEN=your_token_here
   BETSAPI_BASKETBALL_TOKEN=your_token_here
   BETSAPI_TENNIS_TOKEN=your_token_here
   BETSAPI_HOCKEY_TOKEN=your_token_here
   BETSAPI_FOOTBALL_TOKEN=your_token_here

   # Node Version
   NODE_VERSION=20.11.0
   ```

5. **Configure Build Settings**
   - Build Command: `npm install && npm run build && npx prisma migrate deploy`
   - Start Command: `npm run start:production`

6. **Deploy**
   - Railway will automatically deploy
   - PM2 scheduler will start automatically
   - Database migrations will run
   - App will be live!

7. **Get Your URL**
   - Go to "Settings" â†’ "Networking"
   - Generate domain or add custom domain

---

### Option B: Render

1. **Create Account**
   - Go to [render.com](https://render.com)
   - Sign up with GitHub

2. **Create PostgreSQL Database**
   - Click "New +" â†’ "PostgreSQL"
   - Choose free tier
   - Copy the "Internal Database URL"

3. **Create Web Service**
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name:** gambo
     - **Branch:** main
     - **Build Command:** `npm install && npm run build && npx prisma migrate deploy`
     - **Start Command:** `npm run start:production`

4. **Add Environment Variables**

   ```bash
   # Database
   DATABASE_URL=<paste your PostgreSQL internal URL>

   # NextAuth
   NEXTAUTH_URL=https://gambo.onrender.com
   NEXTAUTH_SECRET=<generate secret>

   # AI Service
   GROQ_API_KEY=your_groq_api_key_here

   # BetsAPI
   BETSAPI_SOCCER_TOKEN=your_token_here
   BETSAPI_BASKETBALL_TOKEN=your_token_here
   BETSAPI_TENNIS_TOKEN=your_token_here
   BETSAPI_HOCKEY_TOKEN=your_token_here
   BETSAPI_FOOTBALL_TOKEN=your_token_here
   ```

5. **Deploy**
   - Click "Create Web Service"
   - Wait for deployment (5-10 minutes)
   - Your app will be live!

---

## ğŸ”§ Post-Deployment Setup

### 1. Verify PM2 Scheduler is Running

SSH into your instance (if possible) or check logs:
```bash
pm2 status
```

Should show:
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name             â”‚ status  â”‚ restart â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ gambo-bundles    â”‚ online  â”‚ 0       â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Test Bundle Generation

Manually trigger (via Railway/Render console):
```bash
npm run bundles:generate
```

Check logs:
```bash
pm2 logs gambo-bundles
```

### 3. Verify Database

Check if migrations ran:
```bash
npx prisma studio
```

### 4. Test the App

Visit your deployment URL:
- `https://your-app.up.railway.app` (Railway)
- `https://gambo.onrender.com` (Render)

Test pages:
- `/` - Home page
- `/bundles` - Active bundles
- `/games-analysis` - Analyzed games
- `/live-scores` - Live match updates
- `/pricing` - Subscription tiers

---

## ğŸ“Š Monitoring

### Railway
- Dashboard â†’ Your Service â†’ "Observability"
- View logs, metrics, CPU, memory usage
- PM2 logs: `pm2 logs gambo-bundles`

### Render
- Dashboard â†’ Your Service â†’ "Logs"
- View deployment logs and runtime logs
- PM2 status: Check in shell console

---

## ğŸ”„ Automatic Updates

Both Railway and Render automatically deploy when you push to GitHub:

```bash
git add .
git commit -m "Update feature"
git push origin main
```

Deployment triggers automatically!

---

## âš™ï¸ Environment Variables Explained

### Required Variables

1. **DATABASE_URL**
   - PostgreSQL connection string
   - Auto-generated by Railway
   - Manual setup for Render

2. **NEXTAUTH_URL**
   - Your app's URL
   - Example: `https://gambo.onrender.com`

3. **NEXTAUTH_SECRET**
   - Random secret for JWT tokens
   - Generate: `openssl rand -base64 32`

4. **GROQ_API_KEY**
   - Get from [console.groq.com](https://console.groq.com)
   - Free tier available

5. **BETSAPI_*_TOKEN**
   - Get from [betsapi.com](https://betsapi.com)
   - One token for each sport
   - Can use same token for all

---

## ğŸš¨ Troubleshooting

### Issue: PM2 Not Starting

**Solution:** Check start command includes PM2
```bash
npm run start:production
```

### Issue: Database Connection Failed

**Solution:** Check DATABASE_URL is correct
```bash
echo $DATABASE_URL
```

### Issue: Bundle Generation Not Running

**Solution:** Check PM2 status
```bash
pm2 status gambo-bundles
pm2 logs gambo-bundles
```

### Issue: Rate Limiting from BetsAPI

**Solution:** Wait 1 hour or upgrade BetsAPI plan

### Issue: Build Failed

**Solution:** Check all dependencies installed
```bash
npm install
```

---

## ğŸ“ Database Migrations

### Production Migrations

Migrations run automatically during deployment:
```bash
npx prisma migrate deploy
```

### Manual Migration (if needed)

```bash
npx prisma migrate deploy
npx prisma generate
```

---

## ğŸ¯ Performance Optimization

### 1. Enable Caching

Add to environment:
```bash
NEXT_PUBLIC_CACHE_ENABLED=true
```

### 2. Database Indexes

Already configured in schema:
- Bundle indexes on type, isActive, publishedAt
- AnalyzedGame indexes on sport, country, scheduledAt

### 3. API Rate Limiting

Implemented in generation script:
- 500 fixtures per sport (reduced from 1000)
- 200ms delay between API requests

---

## ğŸ” Security Checklist

- âœ… NEXTAUTH_SECRET is random and secure
- âœ… Database URL not exposed in client
- âœ… API keys stored as environment variables
- âœ… HTTPS enabled (automatic on Railway/Render)
- âœ… No sensitive data in git repository

---

## ğŸ“Š Expected Behavior

### Daily Generation (10 PM)

1. PM2 scheduler triggers generation
2. Fetches 500 fixtures per sport (2,500 total)
3. Analyzes each fixture with Groq AI
4. Creates 7-9 bundles
5. Saves ~700 analyzed games to database
6. Archives old bundles
7. Activates new bundles

### Total Time: 5-10 minutes

### Activities Logged: 60-80
- Soccer leagues: 40-50
- Other sports: 10-20
- Progress updates: 5-10
- System messages: 5-10

---

## ğŸ‰ Success Indicators

After deployment, verify:

1. âœ… App loads at deployment URL
2. âœ… Home page displays correctly
3. âœ… Bundles page shows active bundles
4. âœ… Games Analysis page works with filters
5. âœ… Live Scores page loads
6. âœ… PM2 scheduler running (`pm2 status`)
7. âœ… Database connected (check Prisma Studio)
8. âœ… No errors in logs

---

## ğŸ“ Support

If you encounter issues:

1. Check logs in Railway/Render dashboard
2. Check PM2 logs: `pm2 logs gambo-bundles`
3. Verify environment variables are set
4. Test database connection
5. Check BetsAPI rate limits

---

## ğŸš€ You're All Set!

Your Gambo betting bundle system is now:
- âœ… Deployed to production
- âœ… Running PM2 scheduler
- âœ… Generating bundles daily at 10 PM
- âœ… Saving analyzed games
- âœ… Auto-deploying on git push
- âœ… Monitoring and logging enabled

Happy deploying! ğŸ‰
